name: build

on:
  push:
  pull_request:
  schedule:
    - cron: '30 1 * * 0'

jobs:
  docker-armhf-build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Set up QEMU
        id: qemu
        uses: docker/setup-qemu-action@v3
        with:
          platforms: arm
      - name: Set up Docker Buildx
        id: buildx
        uses: docker/setup-buildx-action@v3
      - name: Build Docker image for armhf arch
        run: |
          VERSION=$(git rev-parse --short HEAD)
          docker buildx build \
            --platform linux/arm/v7 \
            --file Dockerfile . \
            --output "type=docker,name=docker.io/pimba/librespot:${VERSION}"
      - name: List Docker images
        run: docker images
  docker-arm64-build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Set up QEMU
        id: qemu
        uses: docker/setup-qemu-action@v3
        with:
          platforms: arm64
      - name: Set up Docker Buildx
        id: buildx
        uses: docker/setup-buildx-action@v3
      - name: Build Docker image for arm64 arch
        run: |
          VERSION=$(git rev-parse --short HEAD)
          docker buildx build \
            --platform linux/arm64 \
            --file Dockerfile . \
            --output "type=docker,name=docker.io/pimba/librespot:${VERSION}"
      - name: List Docker images
        run: docker images
